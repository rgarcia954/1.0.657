<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" class="_Skins_HTML5___Side_Navigation" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="hardware_reference_montana.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="Web" data-mc-toc-path="[%=System.LinkedTitle%]|Bluetooth Low Energy Baseband Controller">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" /><title>Overview</title>
        <link href="../Resources/TableStyles/Standard.css" rel="stylesheet" data-mc-stylesheet-type="table" />
        <link href="../Resources/Stylesheets/SWM_user_manual_styles.css" rel="stylesheet" type="text/css" />
        <script src="../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" role="banner" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="https://www.onsemi.com/" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div id="mc-main-content" role="main" data-mc-content-body="True">
                                    <h1 class="Heading1"><a name="Overview" data-mc-generated-bookmark="TOC"></a>Overview</h1>
                                    <p class="Body">In general, <span class="mc-variable hardware_reference_montana.Product_Name variable">Montana</span> handles the Bluetooth Low Energy protocol through a Bluetooth Low Energy stack, which is in charge of the upper protocol layers and Bluetooth Low Energy hardware (HW).  User applications are not responsible for Bluetooth Low Energy hardware. Therefore, this topic presents a high-level overview of the design and how it works. </p>
                                    <p class="Note" data-mc-autonum="&lt;i&gt;NOTE: &lt;/i&gt;"><span class="autonumber"><span><i>NOTE: </i></span></span>In this documentation, “BB” refers to Bluetooth Low Energy hardware. While there is a type of baseband processing in the RFFE, take care not to confuse it with the BB controller terminology used here. Throughout this documentation, you can assume that “BB controller” or “baseband controller” always means the Bluetooth&#160;Low Energy hardware, unless it is clearly stated that the RFFE baseband is being referenced.</p>
                                    <p class="Body">Since the Bluetooth Low Energy HW (BB controller or BB) acts like an individual hardware accelerator,   the <span class="mc-variable hardware_reference_montana.Product_Name variable">Montana</span> SoC contains an interface block, the baseband controller interface (BBIF). This block is designed to allow the Arm Cortex-M33 processor to configure the BB controller or to obtain the required information and status from the BB block.</p>
                                    <p class="Body">In the <a href="#Bluetoot" class="FigureHTML MCXref xref xrefFigureHTML">"Bluetooth Low Energy Baseband Controller Block Diagram" figure</a>, the Bluetooth Low Energy HW block diagram and its interface to the other blocks of <span class="mc-variable hardware_reference_montana.Product_Name variable">Montana</span>  are illustrated.</p>
                                    <p>
                                        <img src="bb_ctrl_block_diagram.png" />
                                    </p>
                                    <p class="Figure_title" data-mc-autonum="Figure: "><span class="autonumber"><span>Figure: </span></span><a name="Bluetoot"></a>Bluetooth Low Energy Baseband Controller Block Diagram</p>
                                    <p class="Body">The implementation supports the Bluetooth Low Energy features as follows:</p>
                                    <ul>
                                        <li>Bluetooth 5.2 Specifications compliant</li>
                                        <li>All packet types (Broadcasting / Advertising / Data / Control / Long Range)</li>
                                        <li>Advertising Extension</li>
                                        <li>Encryption / Decryption (AES-CCM)</li>
                                        <li>Bit stream processing (CRC, Whitening)</li>
                                        <li>Frequency hopping calculation (scheme #1 and scheme #2)</li>
                                        <li>FDMA / TDMA / events formatting and synchronization</li>
                                        <li>All device modes support (Broadcaster, Central, Observer, Peripheral)</li>
                                    </ul>
                                    <p class="Body">The software stack schedules, configures, and manages the Bluetooth Low Energy events, while the BB controller processes the actual events, controls the RFFE, and handles real time bit stream processing.</p>
                                    <p class="Body">Bluetooth Low Energy HW is connected to the exchange memory via the SBus, while the <span class="mc-variable hardware_reference_montana.Product_Name variable">Montana</span> processor (Arm Cortex-M33 core) has access to this memory as well. To receive or send data, the BB_DRAM shared memory is used to share and communicate data between the Arm Cortex-M33 processor and the BB controller. The baseband controller communicates with: </p>
                                    <ol>
                                        <li value="1">
                                            <p>The CPU through: </p>
                                            <ol style="list-style-type: lower-alpha;">
                                                <li value="1">The baseband controller interrupts</li>
                                                <li value="2">An internal bus and the DMA that access the internal configuration registers</li>
                                                <li value="3">The SBus and the DMA that access the exchange memory (BB_DRAM0 &amp; BB_DRAM1) parallel to the baseband controller. The memory access is managed by an external arbiter.</li>
                                            </ol>
                                        </li>
                                        <li value="2">The SBus and the DMA that access the exchange memory (BB_DRAM0 &amp; BB_DRAM1) parallel to the baseband controller. The memory access is managed by an external arbiter.</li>
                                        <li value="3">
                                            <p>The RFFE through the control and data signals listed in the <a href="#Interfac" class="TableHTML MCXref xref xrefTableHTML">"Interface Signals Between Baseband Controller and RFFE" table</a>. The control signals are transmitted over an internal SPI. The baseband controller is configured as the master, and the RF front-end as the slave. The RFFE modem sends/receives digital data to/from through the RX/TX data bus, as shown in the <a href="#Bluetoot" class="FigureHTML MCXref xref xrefFigureHTML">"Bluetooth Low Energy Baseband Controller Block Diagram" figure</a>. The clock and reset signals are provided by the BBIF.</p>
                                        </li>
                                    </ol>
                                    <table style="width: 100%;mc-table-style: url('../Resources/TableStyles/Standard.css');" class="TableStyle-Standard" cellspacing="0">
                                        <caption class="TableTitle" data-mc-autonum="Table: "><span class="autonumber"><span>Table: </span></span><a name="Interfac"></a>Interface Signals Between Baseband Controller and RFFE</caption>
                                        <col style="width: 25%;" class="TableStyle-Standard-Column-Column1" />
                                        <col style="width: 25%;" class="TableStyle-Standard-Column-Column1" />
                                        <col style="width: 25%;" class="TableStyle-Standard-Column-Column1" />
                                        <col style="width: 25%;" class="TableStyle-Standard-Column-Column1" />
                                        <tbody>
                                            <tr class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">Signal</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">Baseband Controller</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">RFFE</td>
                                                <td class="TableStyle-Standard-BodyD-Column1-Body1">Description</td>
                                            </tr>
                                            <tr class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">SPI_MISO</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">IN</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">OUT</td>
                                                <td class="TableStyle-Standard-BodyD-Column1-Body1">SPI data slave to master</td>
                                            </tr>
                                            <tr class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">SPI_MOSI</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">OUT</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">IN</td>
                                                <td class="TableStyle-Standard-BodyD-Column1-Body1">SPI data master to slave</td>
                                            </tr>
                                            <tr class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">SPI_CLK</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">OUT</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">IN</td>
                                                <td class="TableStyle-Standard-BodyD-Column1-Body1">SPI data clock</td>
                                            </tr>
                                            <tr class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">SPI_CSN</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">OUT</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">IN</td>
                                                <td class="TableStyle-Standard-BodyD-Column1-Body1">SPI slave device select</td>
                                            </tr>
                                            <tr class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">RX_DATA</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">IN</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">OUT</td>
                                                <td class="TableStyle-Standard-BodyD-Column1-Body1">Rx data</td>
                                            </tr>
                                            <tr class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">RX_CLK</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">IN</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">OUT</td>
                                                <td class="TableStyle-Standard-BodyD-Column1-Body1">Rx data clock</td>
                                            </tr>
                                            <tr class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">SYNC_P</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">IN</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">OUT</td>
                                                <td class="TableStyle-Standard-BodyD-Column1-Body1">Access address detection</td>
                                            </tr>
                                            <tr style="height: 22px;" class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">TX_DATA</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">OUT</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">IN</td>
                                                <td class="TableStyle-Standard-BodyD-Column1-Body1">Tx data</td>
                                            </tr>
                                            <tr class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">TX_DATA_VALID</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">OUT</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">IN</td>
                                                <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                                    <p>Tx data_qualifier</p>
                                                </td>
                                            </tr>
                                            <tr class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">CTE_MODE</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">OUT</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">IN</td>
                                                <td class="TableStyle-Standard-BodyD-Column1-Body1">Enable CTE mode</td>
                                            </tr>
                                            <tr class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">CTE_SAMPLE_P</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">OUT</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">IN</td>
                                                <td class="TableStyle-Standard-BodyD-Column1-Body1">CTE sample pulse</td>
                                            </tr>
                                            <tr class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">IQ_DATA_P</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">IN</td>
                                                <td class="TableStyle-Standard-BodyE-Column1-Body1">OUT</td>
                                                <td class="TableStyle-Standard-BodyD-Column1-Body1">IQ data qualifier</td>
                                            </tr>
                                            <tr class="TableStyle-Standard-Body-Body1">
                                                <td class="TableStyle-Standard-BodyB-Column1-Body1">IQ_DATA</td>
                                                <td class="TableStyle-Standard-BodyB-Column1-Body1">IN</td>
                                                <td class="TableStyle-Standard-BodyB-Column1-Body1">OUT</td>
                                                <td class="TableStyle-Standard-BodyA-Column1-Body1">IQ data</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <p class="Body">When the RF front-end is isolated or powered down, the SPI MISO as well as RX_DATA and RX_CLK signals are forced to zero. When the baseband controller is isolated or powered down, the signals going to the RF front-end are forced to zero (except SPI CSN, which is forced to one). Disabling the RF front-end or the baseband controller  stops and potentially corrupts any ongoing SPI transaction. For testing purpose, all the above signals can be accessed through the GPIOs, as illustrated in the <a href="#Interfac2" class="FigureHTML MCXref xref xrefFigureHTML">"Interface Between the Baseband Controller and the RF Front-End" figure</a>.</p>
                                    <p class="Note" data-mc-autonum="&lt;i&gt;NOTE: &lt;/i&gt;"><span class="autonumber"><span><i>NOTE: </i></span></span>The information in the <a href="#Interfac2" class="FigureHTML MCXref xref xrefFigureHTML">"Interface Between the Baseband Controller and the RF Front-End" figure</a> is for debugging purposes only.</p>
                                    <p>
                                        <img src="interface_bb_ctrl_rffe.png" />
                                    </p>
                                    <p class="Figure_title" data-mc-autonum="Figure: "><span class="autonumber"><span>Figure: </span></span><a name="Interfac2"></a>Interface Between the Baseband Controller and the RF Front-End</p>
                                    <p class="Body">By default, the system is configured such that the BB controller is connected to the RFFE, and the Bluetooth Low Energy stack software configures the RFFE in Test Mode (see Chapter 1 "RF Front-End" on page 1) to be able to communicate with the BB controller. When the <span class="Function">BLE_KE_Init()</span> function is called, the Bluetooth Low Energy stack resets the BB controller, configures the static registers of the RFFE, and prepares the BB controller registers. Finally, it releases the BB from reset and enables it. </p>
                                    <p class="Body">From a network protocol layer point of view, the BB controller is in charge of the link layer controlled and is and manged by the Bluetooth Low Energy SW stack, which means that the link layer is implemented in the BB controller and the Bluetooth Low Energy stack together.</p>
                                    <p class="Body">The BB controller is clocked from a scaled down version of the system clock, known as the master clock. This baseband controller implements a software configurable internal clock divider for generating a 1 MHz reference clock from the master clock. Both are prescaled from the system clock. A description of how to configure the prescale settings is found in <a href="hwref_Bluetooth_BasebandCtrlIntf.htm" class="ChapterAll MCXref xref xrefChapterAll">Baseband Controller Interface</a>.</p>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>